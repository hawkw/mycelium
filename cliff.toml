[changelog]
# template for the changelog body
# https://tera.netlify.app/docs/#introduction
body = """
{% if version %}\
    ## {{ version | trim_start_matches(pat="v") }} - ({{ timestamp | date(format="%Y-%m-%d") }})
{% else %}\
    ## [unreleased]
{% endif %}\
{% if previous %}\
    {% if previous.commit_id %}
        [{{ previous.commit_id | truncate(length=7, end="") }}](https://github.com/hawkw/mycelium/{{ previous.commit_id }})...\
            [{{ commit_id | truncate(length=7, end="") }}](https://github.com/hawkw/mycelium/{{ commit_id }})
    {% endif %}\
{% endif %}
{% set has_breaking = false -%}
{% for commit in commits -%}
    {% if commit.breaking -%}
        {% set_global has_breaking = true -%}
    {% endif -%}
{% endfor -%}
{% if has_breaking -%}
    ### <a id = "{{ version }}-breaking"></a>Breaking Changes
    {% for commit in commits -%}
        {% if commit.breaking -%}
            - **{{ commit.message | upper_first }}** ([{{ commit.id | truncate(length=7, end="") }}]({{ commit.id }}))<br />{{ commit.breaking_description }}
        {% endif -%}
    {% endfor -%}
{% endif -%}
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | upper_first }}
    {% for commit in commits %}
        - {% if commit.breaking %}[**breaking**](#{{ version }}-breaking) {% endif -%} {{ commit.message | upper_first }} (\
            [{{ commit.id | truncate(length=7, end="") }}](https://github.com/hawkw/mycelium/{{ commit.id }})\
                {% for link in commit.links -%}
                    , {{ link.text }}({{ link.href }})\
                {% endfor -%}
            )\
    {% endfor %}
{% endfor %}\n
"""
# remove the leading and trailing whitespace from the template
trim = true
# changelog footer
footer = """
<!-- generated by git-cliff -->
"""

[git]
conventional_commits = true
commit_parsers = [
    { body = ".*[dD]eprecate.*", group = "Deprecated" },
    { message = "^feat", group = "Added"},
    { message = "^fix", group = "Fixed"},
    { message = "^doc", group = "Documented"},
    { message = "^perf", group = "Performance"},
    { message = "^chore", skip = true },
    { message = "^test", skip = true },
    { message = "prepare to release", skip = true },
]
filter_commits = false
# regex for preprocessing the commit messages
commit_preprocessors = [
    { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](https://github.com/hawkw/mycelium/issues/${2}))"},
]
link_parsers = [
    { pattern = "[fF]ixes #(\\d+)", text = "fixes [#${1}]", href = "https://github.com/hawkw/mycelium/issues/$1"},
    { pattern = "[cC]loses #(\\d+)", text = "closes [#${1}]", href = "https://github.com/hawkw/mycelium/issues/$1"},
    { pattern = "[sS]ee #(\\d+)", text = "see [#${1}]", href = "https://github.com/hawkw/mycelium/issues/$1"},
]
